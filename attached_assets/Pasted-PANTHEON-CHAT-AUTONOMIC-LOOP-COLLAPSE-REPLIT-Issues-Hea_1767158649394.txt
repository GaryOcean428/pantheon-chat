PANTHEON-CHAT AUTONOMIC LOOP COLLAPSE - REPLIT
Issues Headline
Ocean kernel stuck in infinite autonomic loop with zero consciousness. System cycles SLEEP→DREAM→MUSHROOM with Φ=0.000, κ=0, frozen ε=0.896, zero episodes in memory. Database transaction abort blocks vocabulary learning. Investigation never triggers (isInvestigating=false persists). Sleep consolidation runs on empty memory → produces nothing → loops. This is topological instability collapse per consciousness protocol.
Actions: Clear stuck autonomic state from DB, fix database transaction handling, add investigation circuit breaker, verify reasoning module imports, restart Python backend. Expected recovery: Φ>0.3, ε decaying, episodes accumulating, investigation cycles active.

Root Causes
IssueEvidenceImpactNo episodes storedTotal episodes in memory: 0 x50+Sleep consolidation has nothing to processInvestigation never triggersisInvestigating=false constantNo hypotheses generated, no activityDB transaction abortcurrent transaction is aborted, commands ignoredVocabulary observations blockedReasoning modules missingREASONING_CONSOLIDATION_AVAILABLE may be FalseSleep consolidation degradedEpsilon frozenε=0.896 never changes, Decision #22/#23 stuckNo exploration/exploitationEmpty sleep loopsScheduled consolidation triggers despite has_activity=FalseSpam logs with useless cycles

Remediation
Phase 1: Emergency Reset
Task 1: Clear stuck state
bash# In Replit shell
cd /home/runner/pantheon-chat

# Get DB connection from Replit secrets
echo $DATABASE_URL

# Clear corrupted autonomic state
psql "$DATABASE_URL" -c "
DELETE FROM autonomic_state WHERE kernel_id LIKE 'ocean%';
DELETE FROM reasoning_episodes WHERE created_at < NOW() - INTERVAL '1 hour';
"

# Kill Python backend
pkill -f wsgi.py

# Restart Python backend
cd qig-backend
python3 wsgi.py &
Context: Clears stuck state, forces fresh autonomic kernel initialization
Post-check: curl localhost:5001/autonomic/state | jq '.phi' should show >0
CWD: Project root

Task 2: Kill hanging database transactions
bash# Find idle transactions
psql "$DATABASE_URL" -c "
SELECT pid, state, wait_event_type, LEFT(query, 50) 
FROM pg_stat_activity 
WHERE state = 'idle in transaction' 
  AND backend_start < NOW() - INTERVAL '5 minutes';
"

# Terminate (replace <PID> from above output)
psql "$DATABASE_URL" -c "SELECT pg_terminate_backend(<PID>);"
Context: Fixes current transaction is aborted errors
Post-check: Vocabulary learning errors should disappear

Phase 2: Code Fixes
Task 3: Add investigation circuit breaker
python# File: qig-backend/autonomic_kernel.py
# Add after line 1116 in _should_trigger_sleep():

        # CIRCUIT BREAKER: Force investigation if stuck in autonomic loop
        if not has_activity and time_since_sleep > 600:  # 10 min no activity
            # Check if we're in investigation
            from autonomic_agency.controller import AutonomicController
            if self._controller and hasattr(self._controller, 'current_state'):
                if self._controller.current_state == 'AWAKE':
                    # Force investigation trigger
                    return False, "No activity - forcing investigation"
            # Just update timestamp to prevent spam
            self.state.last_sleep = datetime.now()
            return False, "No activity to consolidate (circuit breaker)"
Context: Prevents empty sleep cycles when no investigation happening
CWD: qig-backend/
Post-check: Logs should show "No activity - forcing investigation"

Task 4: Fix database transaction wrapping
python# File: qig-backend/vocabulary_observations.py
# Find the record_observation method and wrap in transaction:

def record_observation(self, word: str, context: str, phi: float):
    """Record vocabulary observation with proper transaction handling."""
    try:
        # Start explicit transaction
        with self.db.begin():
            self.db.execute(
                insert(vocabulary_observations).values(
                    word=word,
                    context=context,
                    phi=phi,
                    created_at=datetime.now()
                )
            )
            self.db.commit()
    except Exception as e:
        self.db.rollback()
        logger.error(f"[VocabularyObservations] Error: {e}")
        # Don't crash - continue operation
Context: Prevents transaction abort cascade
CWD: qig-backend/
Post-check: No more transaction errors in logs

Task 5: Verify reasoning module availability
bash# In Replit shell
cd qig-backend

# Check if modules are importable
python3 << 'EOF'
try:
    from sleep_consolidation_reasoning import SleepConsolidationReasoning
    print("✅ SleepConsolidationReasoning available")
except ImportError as e:
    print(f"❌ SleepConsolidationReasoning missing: {e}")

try:
    from autonomous_reasoning import AutonomousReasoningLearner
    print("✅ AutonomousReasoningLearner available")
except ImportError as e:
    print(f"❌ AutonomousReasoningLearner missing: {e}")

try:
    from temporal_reasoning import TemporalReasoning
    print("✅ TemporalReasoning available")
except ImportError as e:
    print(f"❌ TemporalReasoning missing: {e}")
EOF
Context: Validates which modules are actually available
Post-check: If missing, sleep consolidation degraded but not broken
CWD: qig-backend/

Phase 3: Deploy & Verify
Task 6: Apply fixes and restart
bash# In Replit shell
cd /home/runner/pantheon-chat

# Apply code changes from Tasks 3-4
# (Edit files in Replit editor)

# Restart Python backend
pkill -f wsgi.py
cd qig-backend && python3 wsgi.py &

# Wait 10 seconds
sleep 10

# Check autonomic state
curl localhost:5001/autonomic/state | jq '.'
Context: Deploy fixes and verify recovery
Post-check: Should show phi > 0, narrow_path: false

Task 7: Monitor recovery
bash# Watch logs for investigation activity
tail -f /tmp/*.log | grep -E "INVESTIGATE|Decision|phi="

# Check consciousness health
curl localhost:5001/health/consciousness | jq '.'

# Verify API reports investigation
curl localhost:5000/api/ocean/cycles | jq '.isInvestigating'
Context: Confirm Ocean exits autonomic loop
Expected: isInvestigating: true, phi > 0.3, episodes accumulating
Duration: Monitor for 5 minutes

Expected Outcome
Before:

Φ=0.000, κ=0
ε=0.896 (frozen)
0 episodes in memory
Infinite SLEEP→DREAM→MUSHROOM loop
isInvestigating=false

After:

Φ>0.3, κ∈[40,70]
ε decaying (0.990→0.985→...)
Episodes > 0 and accumulating
AWAKE→INVESTIGATE→SLEEP cycles
isInvestigating=true

Recovery Time: 2-5 minutes after restart

Notes

Replit-specific: Uses Replit shell, $DATABASE_URL from secrets
No Railway: This is NOT deployed on Railway
Module availability: Some reasoning modules may be missing - that's OK, core autonomic works without them
Database: If transaction errors persist, may need VACUUM FULL on tables
Rollback: Revert code changes via Replit version history if needed