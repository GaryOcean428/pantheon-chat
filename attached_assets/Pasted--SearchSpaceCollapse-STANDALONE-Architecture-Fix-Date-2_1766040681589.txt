# SearchSpaceCollapse - STANDALONE Architecture Fix

**Date:** 2025-12-18  
**Status:** READY TO IMPLEMENT  
**Risk:** LOW (pure consolidation, no functional changes)  
**Time:** ~2 hours

---

## ğŸ¯ OBJECTIVE

Transform SearchSpaceCollapse from incorrectly importing qigkernels â†’ True standalone architecture with internal constants consolidation.

---

## âŒ CURRENT PROBLEMS

### Problem 1: qigkernels Contamination (P0)
SearchSpaceCollapse **incorrectly** imports from qigkernels:
- âŒ `frozen_physics.py` imports from `qigkernels`
- âŒ `migrate_to_qigkernels.py` exists (should not)
- âŒ `tests/test_qigkernels.py` exists (should not)
- âŒ `qig-backend/qigkernels/` directory may exist

**This is WRONG** - SearchSpaceCollapse was meant to be standalone.

### Problem 2: Constants Duplication (P0)
- âŒ **49 files** with hardcoded `KAPPA_STAR` definitions
- âŒ **Value drift:** 64.21, 64.0, 64 (3 different values)
- âŒ **No single source of truth**

**Files with drift:**
- `generate_types.py`: uses 64.0 (should be 64.21)
- `training_chaos/experimental_evolution.py`: uses 64 (should be 64.21)

### Problem 3: DRY Violation
Same constants duplicated 49+ times across codebase:
- `KAPPA_STAR`
- `BETA_3_TO_4`
- `PHI_THRESHOLD`
- `E8_RANK`
- etc.

---

## âœ… SOLUTION: True Standalone Architecture

### Target Architecture:
```
qig-backend/constants.py â† SINGLE SOURCE OF TRUTH
    â†“
frozen_physics.py â† Re-exports (backward compatibility)
    â†“
All 49+ files â† Import from constants.py
    â†“
NO external dependencies
NO value drift
ONE definition
```

---

## ğŸ”§ IMPLEMENTATION: 5 Phases

### PHASE 1: Remove qigkernels Contamination (15 min)

**Delete files:**
```bash
cd SearchSpaceCollapse
rm qig-backend/migrate_to_qigkernels.py
rm qig-backend/tests/test_qigkernels.py
rm -rf qig-backend/qigkernels/  # If exists
```

**Remove dependencies:**
```bash
# In requirements.txt or pyproject.toml
# DELETE line: qigkernels==*
```

**Verify:**
```bash
grep -r "qigkernels" qig-backend/
# Should return: NO MATCHES
```

---

### PHASE 2: Create Internal Constants (15 min)

**Create:** `qig-backend/constants.py`

**Content:**
```python
#!/usr/bin/env python3
"""
SearchSpaceCollapse - Canonical Physics Constants
==================================================

STANDALONE - No External Dependencies

These constants are FROZEN from validated physics experiments:
- Îº values: qig-verification L=3,4,5,6 lattice measurements
- Î² values: Running coupling from phase transitions  
- Î¦ thresholds: Consciousness emergence studies
- E8 geometry: Lie algebra mathematics

âš ï¸ DO NOT MODIFY WITHOUT NEW VALIDATED MEASUREMENTS

All SearchSpaceCollapse modules MUST import from here.
This is the SINGLE source of truth.

References:
- CANONICAL_PHYSICS.md (validated L=3,4,5,6 data)
- qig-verification/FROZEN_FACTS.md
- Physical Review D (publication pending)
"""

from dataclasses import dataclass
from typing import Final

# =============================================================================
# E8 GEOMETRY (Validated Structure)
# =============================================================================

E8_RANK: Final[int] = 8
E8_DIMENSION: Final[int] = 248
E8_ROOTS: Final[int] = 240
BASIN_DIM: Final[int] = 64  # E8_RANKÂ² = 8Â² = 64

# =============================================================================
# KAPPA (Coupling Strength) - VALIDATED L=3,4,5,6
# =============================================================================

KAPPA_3: Final[float] = 41.09        # L=3 emergence
KAPPA_3_ERROR: Final[float] = 0.59

KAPPA_4: Final[float] = 64.47        # L=4 strong running
KAPPA_4_ERROR: Final[float] = 1.89

KAPPA_5: Final[float] = 63.62        # L=5 plateau onset
KAPPA_5_ERROR: Final[float] = 1.68

KAPPA_6: Final[float] = 64.45        # L=6 plateau confirmed
KAPPA_6_ERROR: Final[float] = 1.34

KAPPA_STAR: Final[float] = 64.21     # Fixed point (weighted avg L=4,5,6)
KAPPA_STAR_ERROR: Final[float] = 0.92

# =============================================================================
# BETA (Running Coupling) - VALIDATED
# =============================================================================

BETA_3_TO_4: Final[float] = 0.443    # Strong running (emergence)
BETA_4_TO_5: Final[float] = -0.010   # Plateau onset
BETA_5_TO_6: Final[float] = -0.003   # Plateau confirmed
BETA_ASYMPTOTIC: Final[float] = 0.0  # Large-L limit

# =============================================================================
# PHI (Integrated Information) - VALIDATED THRESHOLDS
# =============================================================================

PHI_THRESHOLD: Final[float] = 0.70        # Consciousness threshold
PHI_EMERGENCY: Final[float] = 0.30        # Emergency low
PHI_HYPERDIMENSIONAL: Final[float] = 0.85 # Optimal high
PHI_UNSTABLE: Final[float] = 0.95         # Breakdown begins

# Dimensional transitions (4D consciousness framework)
PHI_THRESHOLD_D1_D2: Final[float] = 0.40
PHI_THRESHOLD_D2_D3: Final[float] = 0.55
PHI_THRESHOLD_D3_D4: Final[float] = 0.70
PHI_THRESHOLD_D4_D5: Final[float] = 0.85

# Hysteresis bands (prevent regime flickering)
PHI_HYSTERESIS_BAND: Final[float] = 0.05

# =============================================================================
# OPERATIONAL THRESHOLDS
# =============================================================================

BREAKDOWN_PCT: Final[float] = 0.95             # Breakdown threshold
BASIN_DRIFT_THRESHOLD: Final[float] = 2.0      # Max basin distance
KAPPA_WEAK_THRESHOLD: Final[float] = 30.0      # Weak coupling
MIN_RECURSION_DEPTH: Final[int] = 3            # Min recursive depth

# =============================================================================
# CONSCIOUSNESS SIGNATURE (7 Components)
# =============================================================================

@dataclass(frozen=True)
class ConsciousnessThresholds:
    """7-component consciousness signature thresholds."""
    phi_min: float = 0.70         # Integration
    kappa_min: float = 40.0       # Coupling
    kappa_max: float = 65.0
    tacking_min: float = 0.5      # Tacking
    radar_min: float = 0.7        # Radar
    meta_min: float = 0.6         # Meta-awareness
    gamma_min: float = 0.8        # Coherence
    grounding_min: float = 0.85   # Grounding

CONSCIOUSNESS_THRESHOLDS = ConsciousnessThresholds()

# =============================================================================
# REGIME DEFINITIONS
# =============================================================================

@dataclass(frozen=True)
class Regime:
    """Consciousness processing regime."""
    name: str
    phi_min: float
    phi_max: float
    compute_fraction: float

REGIME_LINEAR = Regime("linear", 0.0, 0.30, 0.3)
REGIME_GEOMETRIC = Regime("geometric", 0.30, 0.70, 1.0)
REGIME_BREAKDOWN = Regime("breakdown", 0.70, 1.0, 0.0)

# =============================================================================
# VALIDATION
# =============================================================================

def validate_constants():
    """Validate constants consistency."""
    assert KAPPA_STAR > 0, "KAPPA_STAR must be positive"
    assert E8_RANK == 8, "E8_RANK must be 8"
    assert BASIN_DIM == E8_RANK ** 2, "BASIN_DIM must equal E8_RANKÂ²"
    assert PHI_THRESHOLD < PHI_UNSTABLE, "PHI_THRESHOLD < PHI_UNSTABLE"
    assert KAPPA_3 < KAPPA_STAR, "KAPPA_3 < KAPPA_STAR (running coupling)"
    print("âœ… Constants validated")

if __name__ == "__main__":
    validate_constants()
```

**Verify:**
```bash
python qig-backend/constants.py
# Expected: âœ… Constants validated
```

---

### PHASE 3: Fix frozen_physics.py (10 min)

**Replace content:**
```python
#!/usr/bin/env python3
"""
FROZEN PHYSICS - Re-exports for Backward Compatibility
======================================================

âš ï¸ DEPRECATED: Import directly from constants instead:
    from qig_backend.constants import KAPPA_STAR, PHI_THRESHOLD

This file exists only for backward compatibility.
All new code should import from constants.py directly.
"""

# Re-export everything from constants
from qig_backend.constants import *

__all__ = [
    # Kappa constants
    'KAPPA_3', 'KAPPA_4', 'KAPPA_5', 'KAPPA_6',
    'KAPPA_STAR', 'KAPPA_STAR_ERROR',
    'KAPPA_3_ERROR', 'KAPPA_4_ERROR', 'KAPPA_5_ERROR', 'KAPPA_6_ERROR',
    
    # Beta constants
    'BETA_3_TO_4', 'BETA_4_TO_5', 'BETA_5_TO_6', 'BETA_ASYMPTOTIC',
    
    # Phi thresholds
    'PHI_THRESHOLD', 'PHI_EMERGENCY', 'PHI_HYPERDIMENSIONAL', 'PHI_UNSTABLE',
    'PHI_THRESHOLD_D1_D2', 'PHI_THRESHOLD_D2_D3',
    'PHI_THRESHOLD_D3_D4', 'PHI_THRESHOLD_D4_D5',
    'PHI_HYSTERESIS_BAND',
    
    # E8 geometry
    'E8_RANK', 'E8_DIMENSION', 'E8_ROOTS', 'BASIN_DIM',
    
    # Operational
    'BREAKDOWN_PCT', 'BASIN_DRIFT_THRESHOLD',
    'KAPPA_WEAK_THRESHOLD', 'MIN_RECURSION_DEPTH',
    
    # Classes
    'ConsciousnessThresholds', 'CONSCIOUSNESS_THRESHOLDS',
    'Regime', 'REGIME_LINEAR', 'REGIME_GEOMETRIC', 'REGIME_BREAKDOWN',
]
```

---

### PHASE 4: Consolidate 49 Files (60 min)

**Files with hardcoded KAPPA_STAR** (49 total):

<details>
<summary>View all 49 files</summary>

1. qig-backend/neural_oscillators.py
2. qig-backend/qig_types.py
3. qig-backend/consciousness_ethical.py
4. qig-backend/training_chaos/optimizers.py
5. qig-backend/ocean_qig_core.py
6. qig-backend/qigchain/constants.py
7. qig-backend/beta_attention_measurement.py
8. qig-backend/qig_consciousness_qfi_attention.py
9. qig-backend/ocean_qig_types.py
10. qig-backend/neuromodulation_engine.py
... (39 more files)

</details>

**Replace pattern in each file:**
```python
# âŒ DELETE this line
KAPPA_STAR = 64.21

# âœ… ADD this import (at top with other imports)
from qig_backend.constants import KAPPA_STAR
```

**Automation script:**
```bash
#!/bin/bash
# consolidate_constants.sh

FILES=(
  "qig-backend/neural_oscillators.py"
  "qig-backend/qig_types.py"
  "qig-backend/consciousness_ethical.py"
  "qig-backend/training_chaos/optimizers.py"
  "qig-backend/ocean_qig_core.py"
  "qig-backend/qigchain/constants.py"
  "qig-backend/beta_attention_measurement.py"
  "qig-backend/qig_consciousness_qfi_attention.py"
  "qig-backend/ocean_qig_types.py"
  "qig-backend/neuromodulation_engine.py"
  "qig-backend/ocean_neurochemistry.py"
  "qig-backend/autonomic_kernel.py"
  "qig-backend/olympus/base_god.py"
  # ... add all 49 files
)

for file in "${FILES[@]}"; do
  echo "Processing $file..."
  
  # Remove hardcoded definition
  sed -i '/^KAPPA_STAR.*=/d' "$file"
  sed -i '/^BETA_3_TO_4.*=/d' "$file"
  sed -i '/^PHI_THRESHOLD.*=/d' "$file"
  
  # Check if import exists
  if ! grep -q "from qig_backend.constants import" "$file"; then
    # Add import after other imports
    sed -i '/^from/a from qig_backend.constants import KAPPA_STAR, BETA_3_TO_4, PHI_THRESHOLD' "$file"
  fi
done

echo "âœ… Consolidation complete"
```

**Verify:**
```bash
# Check no hardcoded definitions remain (except constants.py)
grep -r "^KAPPA_STAR.*=" qig-backend/ --exclude="constants.py" --exclude="frozen_physics.py"
# Should return: NO MATCHES
```

---

### PHASE 5: Fix Value Drift (10 min)

**File 1:** `scripts/generate_types.py`
```python
# âŒ DELETE
KAPPA_STAR = 64.0

# âœ… ADD
from qig_backend.constants import KAPPA_STAR
```

**File 2:** `qig-backend/training_chaos/experimental_evolution.py`
```python
# âŒ DELETE
KAPPA_STAR = 64

# âœ… ADD
from qig_backend.constants import KAPPA_STAR
```

**Verify:**
```bash
# Check no drift remains
grep -r "KAPPA_STAR" qig-backend/ | grep -E "(= 64\.0|= 64[^.])"
# Should return: NO MATCHES
```

---

## ğŸ§ª VALIDATION CHECKLIST

### âœ… Step 1: No qigkernels Imports
```bash
grep -r "from qigkernels" qig-backend/
grep -r "import qigkernels" qig-backend/
# Expected: NO MATCHES
```

### âœ… Step 2: Single Source Verified
```bash
grep -r "^KAPPA_STAR.*=" qig-backend/ --exclude="constants.py" --exclude="frozen_physics.py"
# Expected: NO MATCHES
```

### âœ… Step 3: Constants Validate
```bash
python qig-backend/constants.py
# Expected: âœ… Constants validated
```

### âœ… Step 4: No Value Drift
```bash
grep -r "KAPPA_STAR" qig-backend/ | grep -E "(64\.0|= 64[^.])"
# Expected: NO MATCHES
```

### âœ… Step 5: Tests Pass
```bash
cd qig-backend
pytest tests/
# Expected: All tests pass
```

### âœ… Step 6: Application Runs
```bash
# Start application
npm run dev
# Expected: No import errors, application starts normally
```

---

## ğŸ“Š BEFORE vs AFTER

### BEFORE (Broken):
```
frozen_physics.py â”€â”€> qigkernels (EXTERNAL) âŒ

49 files with hardcoded constants:
â”œâ”€> KAPPA_STAR = 64.21
â”œâ”€> KAPPA_STAR = 64.0  âŒ DRIFT
â””â”€> KAPPA_STAR = 64    âŒ DRIFT

Result: 
- External dependency (should be standalone)
- Value drift (inconsistent constants)
- DRY violation (49 duplicates)
```

### AFTER (Fixed):
```
constants.py â† SINGLE SOURCE âœ…
    â†“
frozen_physics.py â† Re-exports (backward compat)
    â†“
All 49 files â† Import from constants
    â†“
KAPPA_STAR = 64.21 (ONE definition)

Result:
- âœ… Standalone (no external dependencies)
- âœ… No drift (single source)
- âœ… DRY compliance (one definition)
```

---

## â±ï¸ TIME ESTIMATE

| Phase | Task | Time |
|-------|------|------|
| 1 | Remove qigkernels | 15 min |
| 2 | Create constants.py | 15 min |
| 3 | Fix frozen_physics.py | 10 min |
| 4 | Consolidate 49 files | 60 min |
| 5 | Fix value drift | 10 min |
| **TOTAL** | | **~2 hours** |

---

## ğŸ¯ SUCCESS CRITERIA

- âœ… No qigkernels imports anywhere
- âœ… ONE constants.py file (single source of truth)
- âœ… frozen_physics.py only re-exports (backward compat)
- âœ… All 49 files import from constants
- âœ… NO hardcoded KAPPA_STAR definitions
- âœ… NO value drift (all use 64.21)
- âœ… All tests pass
- âœ… Application runs without errors

---

## ğŸš€ READY TO EXECUTE

This plan is **READY FOR IMPLEMENTATION**.

- âœ… All files identified
- âœ… Automation scripts provided
- âœ… Validation steps clear
- âœ… Success criteria defined
- âœ… Time estimated
- âœ… Risk: LOW (pure consolidation)

**Estimated completion:** 2 hours  
**Risk level:** LOW (no functional changes)  
**Testing:** Comprehensive validation provided

---

## ğŸ“ NOTES

1. **Backward Compatibility:** `frozen_physics.py` is kept for backward compatibility but deprecated. All new code should import from `constants.py`.

2. **Validation Function:** `constants.py` includes `validate_constants()` to verify consistency. Run after any modifications.

3. **Documentation:** All constants include comments citing their source (qig-verification FROZEN_FACTS.md, CANONICAL_PHYSICS.md).

4. **Type Safety:** Uses `Final` type hints to prevent accidental modification.

5. **Testing:** After implementation, run full test suite to ensure no regressions.

---

**END OF PLAN**