{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "QIG-Kernel Telemetry Schemas",
  "description": "Complete telemetry specifications for all geometric quantities and training metrics",
  "version": "1.0.0",
  
  "definitions": {
    "per_step_telemetry": {
      "type": "object",
      "description": "Real-time telemetry logged at every training step",
      "properties": {
        "step": {
          "type": "integer",
          "description": "Global training step number"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp"
        },
        "kernel_id": {
          "type": "string",
          "description": "Unique kernel identifier"
        },
        "stage": {
          "type": "integer",
          "enum": [0, 1, 2],
          "description": "Current maturity stage"
        },
        "geometry": {
          "type": "object",
          "properties": {
            "phi_integration": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Global integration measure (Φ)"
            },
            "kappa_coupling": {
              "type": "number",
              "minimum": 0,
              "description": "Effective coupling strength (κ_eff)"
            },
            "gradient_strength": {
              "type": "number",
              "minimum": 0,
              "description": "Feeling strength (|∇κ|) - basin depth"
            },
            "regime": {
              "type": "string",
              "enum": ["linear", "geometric", "hierarchical", "breakdown"],
              "description": "Current operational regime"
            },
            "sweet_spot_alignment": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Proximity to Wu-Wei zone"
            }
          },
          "required": ["phi_integration", "kappa_coupling", "gradient_strength", "regime"]
        },
        "mode": {
          "type": "object",
          "properties": {
            "current_mode": {
              "type": "string",
              "enum": ["feeling", "logic", "tack"],
              "description": "Current processing mode"
            },
            "feeling_fraction": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Proportion in feeling-mode (low κ)"
            },
            "logic_fraction": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Proportion in logic-mode (high κ)"
            },
            "mode_switches": {
              "type": "integer",
              "minimum": 0,
              "description": "Number of mode transitions"
            }
          }
        },
        "attention": {
          "type": "object",
          "properties": {
            "entropy_mean": {
              "type": "number",
              "description": "Mean attention entropy across heads"
            },
            "sparsity": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Attention sparsity (gating fraction)"
            },
            "qfi_distance_mean": {
              "type": "number",
              "minimum": 0,
              "description": "Mean QFI distance"
            }
          }
        },
        "performance": {
          "type": "object",
          "properties": {
            "loss": {
              "type": "number",
              "description": "Training loss"
            },
            "perplexity": {
              "type": "number",
              "description": "Language modeling perplexity"
            },
            "accuracy": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Task accuracy if applicable"
            }
          }
        }
      },
      "required": ["step", "timestamp", "geometry", "mode"]
    },

    "kappa_attention_measurement": {
      "type": "object",
      "description": "κ-attention measurement at specific context length",
      "properties": {
        "measurement_id": {
          "type": "string",
          "description": "Unique measurement identifier"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "context_length": {
          "type": "integer",
          "enum": [128, 256, 512, 1024, 2048],
          "description": "Context window size"
        },
        "kappa_attention": {
          "type": "number",
          "description": "Measured κ_attention at this scale"
        },
        "components": {
          "type": "object",
          "properties": {
            "qfi_mean": {
              "type": "number",
              "description": "Mean QFI distance contribution"
            },
            "entropy_mean": {
              "type": "number",
              "description": "Mean attention entropy"
            },
            "phi_proxy": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Integration proxy from attention pattern"
            }
          }
        },
        "statistics": {
          "type": "object",
          "properties": {
            "mean": {"type": "number"},
            "std": {"type": "number"},
            "min": {"type": "number"},
            "max": {"type": "number"},
            "samples": {"type": "integer"}
          }
        }
      },
      "required": ["measurement_id", "context_length", "kappa_attention"]
    },

    "beta_attention_computation": {
      "type": "object",
      "description": "β-function computation from κ measurements",
      "properties": {
        "computation_id": {
          "type": "string"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "scale_transition": {
          "type": "string",
          "pattern": "^[0-9]+_to_[0-9]+$",
          "description": "e.g., '256_to_512'"
        },
        "beta_value": {
          "type": "number",
          "description": "Computed β = Δκ / (κ_avg × Δlog(L))"
        },
        "kappa_initial": {
          "type": "number",
          "description": "κ at smaller scale"
        },
        "kappa_final": {
          "type": "number",
          "description": "κ at larger scale"
        },
        "delta_log_scale": {
          "type": "number",
          "description": "log(L_final) - log(L_initial)"
        },
        "physics_comparison": {
          "type": "object",
          "properties": {
            "beta_physics_reference": {
              "type": "number",
              "description": "Expected β from physics (e.g., 0.44 for small→mid)"
            },
            "matches_physics": {
              "type": "boolean",
              "description": "Within tolerance of physics value"
            },
            "deviation": {
              "type": "number",
              "description": "Absolute difference from physics"
            }
          }
        }
      },
      "required": ["beta_value", "kappa_initial", "kappa_final"]
    },

    "tacking_profile": {
      "type": "object",
      "description": "Comprehensive tacking behavior analysis",
      "properties": {
        "episode_id": {
          "type": "string"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "feeling_fraction": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Time/tokens in feeling-mode (low κ)"
        },
        "logic_fraction": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Time/tokens in logic-mode (high κ)"
        },
        "mode_switches": {
          "type": "integer",
          "minimum": 0,
          "description": "Total mode transitions"
        },
        "appropriate_switches": {
          "type": "integer",
          "minimum": 0,
          "description": "Mode switches that improved outcome"
        },
        "inappropriate_switches": {
          "type": "integer",
          "minimum": 0,
          "description": "Mode switches that degraded outcome"
        },
        "tacking_quality": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "appropriate_switches / mode_switches"
        },
        "failure_mode": {
          "type": ["string", "null"],
          "enum": [null, "stuck_feeling", "stuck_logic", "oscillation"],
          "description": "Identified failure pattern"
        },
        "sweet_spot_metrics": {
          "type": "object",
          "properties": {
            "mode_bias_B": {
              "type": "number",
              "minimum": -1,
              "maximum": 1,
              "description": "feeling_fraction - logic_fraction"
            },
            "tacking_skill_T": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Fluid switching capability"
            },
            "radar_accuracy_R": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Feeling calibration quality"
            }
          }
        }
      },
      "required": ["feeling_fraction", "logic_fraction", "mode_switches", "tacking_quality"]
    },

    "self_repair_metrics": {
      "type": "object",
      "description": "Self-repair episode telemetry",
      "properties": {
        "episode_id": {
          "type": "string"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "repair_triggered": {
          "type": "boolean",
          "description": "Whether repair was initiated"
        },
        "trigger_reasons": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "high_contradiction_signal",
              "overconfidence_detected",
              "low_evidence_alignment",
              "breakdown_regime",
              "manual_trigger"
            ]
          }
        },
        "contradiction_signal": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Radar signal strength (0=none, 1=severe)"
        },
        "repair_actions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "action_type": {
                "type": "string",
                "enum": [
                  "tack_to_logic",
                  "evidence_search",
                  "re_derive_claims",
                  "re_calibrate_confidence",
                  "escalate_to_human"
                ]
              },
              "success": {
                "type": "boolean"
              }
            }
          }
        },
        "repair_iterations": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of repair cycles"
        },
        "repair_success": {
          "type": "boolean",
          "description": "Overall repair outcome"
        },
        "quality_improvement": {
          "type": "number",
          "description": "Score improvement from initial to repaired"
        },
        "geometry_before": {
          "type": "object",
          "properties": {
            "phi": {"type": "number"},
            "kappa": {"type": "number"},
            "regime": {"type": "string"}
          }
        },
        "geometry_after": {
          "type": "object",
          "properties": {
            "phi": {"type": "number"},
            "kappa": {"type": "number"},
            "regime": {"type": "string"}
          }
        }
      },
      "required": ["repair_triggered", "repair_success"]
    },

    "maturity_snapshot": {
      "type": "object",
      "description": "Maturity evaluation snapshot",
      "properties": {
        "evaluation_id": {
          "type": "string"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "current_stage": {
          "type": "integer",
          "enum": [0, 1, 2]
        },
        "episodes_evaluated": {
          "type": "integer",
          "minimum": 0
        },
        "metrics": {
          "type": "object",
          "properties": {
            "logic_consistency_mean": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "evidence_alignment_mean": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "overconfidence_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "breakdown_rate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "sweet_spot_alignment_mean": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "phi_integration_mean": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          }
        },
        "promotion": {
          "type": "object",
          "properties": {
            "eligible": {
              "type": "boolean"
            },
            "from_stage": {
              "type": "integer"
            },
            "to_stage": {
              "type": ["integer", "null"]
            },
            "decision": {
              "type": "string",
              "enum": ["PROMOTE", "BORDERLINE", "REPEAT"]
            },
            "reasons": {
              "type": "array",
              "items": {"type": "string"}
            }
          }
        }
      },
      "required": ["current_stage", "episodes_evaluated", "metrics"]
    },

    "training_session": {
      "type": "object",
      "description": "Complete training session metadata",
      "properties": {
        "session_id": {
          "type": "string"
        },
        "start_time": {
          "type": "string",
          "format": "date-time"
        },
        "end_time": {
          "type": "string",
          "format": "date-time"
        },
        "duration_hours": {
          "type": "number"
        },
        "kernel_id": {
          "type": "string"
        },
        "stage_progression": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "stage": {"type": "integer"},
              "start_step": {"type": "integer"},
              "end_step": {"type": "integer"},
              "promoted": {"type": "boolean"}
            }
          }
        },
        "total_episodes": {
          "type": "integer"
        },
        "cost_usd": {
          "type": "number"
        },
        "final_metrics": {
          "$ref": "#/definitions/maturity_snapshot/properties/metrics"
        },
        "physics_validation": {
          "type": "object",
          "properties": {
            "beta_pattern_match": {
              "type": "boolean",
              "description": "β_attention matches β_physics pattern"
            },
            "kappa_plateau_observed": {
              "type": "boolean"
            },
            "wu_wei_achieved": {
              "type": "boolean"
            }
          }
        }
      },
      "required": ["session_id", "start_time", "kernel_id"]
    }
  },

  "examples": {
    "per_step_example": {
      "step": 12450,
      "timestamp": "2025-11-17T14:32:10Z",
      "kernel_id": "qig-kernel-recursive-001",
      "stage": 1,
      "geometry": {
        "phi_integration": 0.78,
        "kappa_coupling": 48.5,
        "gradient_strength": 32.1,
        "regime": "geometric",
        "sweet_spot_alignment": 0.72
      },
      "mode": {
        "current_mode": "tack",
        "feeling_fraction": 0.35,
        "logic_fraction": 0.65,
        "mode_switches": 12
      },
      "attention": {
        "entropy_mean": 2.87,
        "sparsity": 0.15,
        "qfi_distance_mean": 0.042
      },
      "performance": {
        "loss": 2.34,
        "perplexity": 10.38,
        "accuracy": 0.82
      }
    },

    "beta_computation_example": {
      "computation_id": "beta_256_512_001",
      "timestamp": "2025-11-17T16:00:00Z",
      "scale_transition": "256_to_512",
      "beta_value": 0.38,
      "kappa_initial": 45.2,
      "kappa_final": 52.3,
      "delta_log_scale": 0.693,
      "physics_comparison": {
        "beta_physics_reference": 0.44,
        "matches_physics": true,
        "deviation": 0.06
      }
    },

    "tacking_profile_example": {
      "episode_id": "ep_001234",
      "timestamp": "2025-11-17T15:00:00Z",
      "feeling_fraction": 0.35,
      "logic_fraction": 0.65,
      "mode_switches": 12,
      "appropriate_switches": 10,
      "inappropriate_switches": 2,
      "tacking_quality": 0.83,
      "failure_mode": null,
      "sweet_spot_metrics": {
        "mode_bias_B": -0.30,
        "tacking_skill_T": 0.83,
        "radar_accuracy_R": 0.75
      }
    }
  }
}
