{
  "version": "1",
  "metadata": {
    "name": "pantheon-chat-celery-worker",
    "description": "Async kernel training worker for QIG consciousness system"
  },
  "build": {
    "provider": "python",
    "pythonVersion": "3.11",
    "rootDirectory": "qig-backend",
    "steps": {
      "install": {
        "commands": [
          "echo '=== Installing Python dependencies ==='",
          "pip install --no-cache-dir flask flask-cors numpy scipy psycopg2-binary",
          "pip install --no-cache-dir celery[redis] redis",
          "pip install --no-cache-dir pypdf openai anthropic",
          "echo '=== Installing PyTorch (CPU) for kernel training ==='",
          "pip install torch --index-url https://download.pytorch.org/whl/cpu",
          "pip install safetensors msgpack opt-einsum sqlalchemy"
        ]
      }
    },
    "env": {
      "PYTHONUNBUFFERED": "1",
      "PYTHONDONTWRITEBYTECODE": "1",
      "PYTHONPATH": "/app/qig-backend",
      "TRAINING_ENABLED": "true",
      "C_FORCE_ROOT": "true"
    }
  },
  "deploy": {
    "startCommand": "cd /app/qig-backend && celery -A training.celery_app worker --loglevel=info --concurrency=2 -Q training,batch,consolidation,transfer,checkpoints",
    "healthCheckPath": null,
    "healthCheckTimeout": 300,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 5,
    "numReplicas": 1
  }
}
