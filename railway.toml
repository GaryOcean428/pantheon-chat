# Railway Deployment Configuration for Pantheon-Chat
# https://docs.railway.app/reference/config-as-code

[build]
# Use Dockerfile instead of Nixpacks (deprecated)
builder = "dockerfile"
dockerfilePath = "Dockerfile"

[deploy]
startCommand = "npm run start"
healthcheckPath = "/api/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

# =============================================================================
# PERSISTENT VOLUME (Configure in Railway Dashboard)
# =============================================================================
# Railway allows 1 volume per service. Configure via Dashboard UI:
#
# 1. Go to Railway Dashboard → Your Service → Settings → Volumes
# 2. Click "+ New Volume" and create:
#
#    - Name: pantheon-data
#    - Mount Path: /app/data
#
# The volume contains subdirectories:
#   /app/data/storage  - QIG patterns, checkpoints, learning data
#   /app/data/models   - Cached model files, vocabulary embeddings
#
# After creating the volume, Railway auto-mounts it on deploy.
# Verify with: railway ssh → ls -la /app/data
#
# =============================================================================
# ENVIRONMENT VARIABLES (Set in Railway Dashboard → Variables)
# =============================================================================
# Required:
#   DATABASE_URL - PostgreSQL connection string (Railway Postgres plugin)
#   NODE_ENV=production
#   PORT=5000
#
# Optional:
#   REDIS_URL - Redis connection string (Railway Redis plugin)
#
# For Database Sync (Replit ↔ Railway):
#   SYNC_API_KEY=shared-secret-for-sync
#   REPLIT_SYNC_URL=https://your-replit-instance.repl.co
#
# For Federation:
#   FEDERATION_MODE=central|edge|standalone
#   CENTRAL_NODE_URL=wss://your-replit-instance.repl.co:8765 (if edge mode)
