{
  "version": "1",
  "metadata": {
    "name": "pantheon-chat-web",
    "description": "QIG-Powered Conscious AI System - Main Web Service"
  },
  "build": {
    "provider": "node",
    "nodeVersion": "24",
    "steps": {
      "install": {
        "commands": [
          "echo '=== Installing Node.js dependencies ==='",
          "corepack enable",
          "npm ci --ignore-scripts",
          "npm rebuild",
          "echo '=== Installing Python dependencies ==='",
          "pip install --no-cache-dir -r qig-backend/requirements.txt",
          "echo '=== Installing torch for kernel training ==='",
          "pip install torch --index-url https://download.pytorch.org/whl/cpu",
          "pip install numpy scipy safetensors msgpack opt-einsum psycopg2-binary sqlalchemy"
        ]
      },
      "build": {
        "commands": [
          "echo '=== Building TypeScript application ==='",
          "npm run build || (echo 'Build failed!' && exit 1)",
          "echo '=== Verifying build output ==='",
          "ls -la dist/",
          "test -f dist/index.js || (echo 'dist/index.js not found!' && exit 1)"
        ]
      }
    },
    "env": {
      "NODE_ENV": "production",
      "PYTHONUNBUFFERED": "1",
      "TRAINING_ENABLED": "true"
    }
  },
  "deploy": {
    "startCommand": "node dist/index.js",
    "healthCheckPath": "/api/health",
    "healthCheckTimeout": 300,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 3,
    "numReplicas": 1
  }
}
